<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=">
    <title>電影詳情 ｜ NCU MIS SA</title>
    <link href="statics/icon/favicon.ico" type="image/x-icon" rel="icon">
    <link href="statics/icon/favicon.ico" type="image/x-icon" rel="shortcut icon">
   
    <link href="statics/css/bootstrap.min.css" rel="stylesheet">
    <script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
<style>
 	body{ 
 	background-image: url("statics/img/moviebg.jpg") ;
 	background-size:1520px 850px;
 	background-position: 0% 10%;
   background-repeat:no-repeat;
 	                 
 	}
 	div.txt{
 	  font-size:120%;
 	} 
 	div.icon{
 	    position:absolute;
 	     left: 660px;
        top: 82px;
 	}
</style>
</head>

<body>
   <div include-html="statics/components/header.html"></div>
      
        <div id="content"  > 
        <div class="icon">
             <img src="statics/icon/film.png" width="31" height="32" ></div>
            <h2 style="text-align:center"><b>電影詳情</b></h2>
            <div id="viewmovie" style="text-align:center" >
            <a href="viewmovie.html" >電影列表</a><br>
            </div>
            
            

            <div id="flashMessage" class="message" style="display: none;"></div>

			  
      <div id="flashMessage" class="message" style="display: none;"></div>

			 
    			
      				<div id="movie_panel" >
      				</div>
    			
  			
  			  
  			 
    		
      				<div id="session_panel">
      				</div>
    			
    			
  			  <script src="statics/js/include-html.js"></script> 
			
            <script type="text/javascript">
                // 取得網址參數
                var url_string = window.location.href;
                var url = new URL(url_string);
                var mid = url.searchParams.get("id");
                var movie_id = parseInt(mid) ;
                var sql_num = 0;
                function getMovie() {
                    $.ajax({
                        type: "GET",
                        url: "api/movie.do",
                        crossDomain: true,
                        data: "id=" + mid,
                        cache: false,
                        dataType: 'json',
                        timeout: 5000,
                        success: function (response) {
                            if (response.status == 200) {
                          	var movie_panel = '';
                          	
                          	$.each(response.response.data, function (){		//因為是一個array
                          		movie_panel += addMovie(this);		//把每個東西塞進product_panel
                          		
                          	})
                          	
                          	$("#movie_panel").append(movie_panel);
                            }
                          },

                        error: function () {
                            alert("無法連線到伺服器！");
                        }
                    });
                }
                
                getMovie();
                
                function addMovie(data) {		//每抓到一個movie 就add movie
                	let inner_html = '';
                	//inner_html += '<div class="col-md-4">';
               		inner_html += '<div class="container">';
               		inner_html += '<br>';
               		inner_html += '<h3 style="font-weight:bold;text-align:center">' + data.name + '</h3>';

             		inner_html += '<div class="pic">';
             		inner_html += '<img src="statics/img/movie/' + data.cover + '" style="float: left;margin:30px" width="33%" >';
             		inner_html += '</div>';
            		
             		inner_html += '<br>';
            		inner_html += '<div class="txt">';
            		inner_html += '<p style="font-weight:bold">內容介紹：' + data.content + '</p>';
            		inner_html += '<p style="font-weight:bold">影片長度：' + data.running_time + '分鐘</p>';
            		inner_html += '<p style="font-weight:bold">分級：' + data.genre + '</p>';
            		inner_html += '<p style="font-weight:bold">上映日期：' + data.release_date + '</p>';
            		inner_html += '</div>';
            		
            		//inner_html += '<a class="p-2 text-dark" href="movie_detail.html?id=' + data.id+'"><font color="blue">詳細資訊</font></a>';
            		//inner_html += '<button id="add_cart_' + data.id + '" name="add_cart" type="button" class="btn btn-lg btn-block btn-outline-primary">加入購物車</button>';
            		//inner_html += '</div><small class="text-muted">id: ' + data.id + '</small>';
            		inner_html += '</div>';
                	
            		return inner_html;
                }
                
				
                function getSession() {
                    $.ajax({
                        type: "GET",
                        url: "api/moviesession.do",
                        crossDomain: true,
                        data: "id=" + mid,
                        cache: false,
                        dataType: 'json',
                        timeout: 5000,
                        success: function (response) {
                            if (response.status == 200) {
                            	var session_panel = '';
                            	
                          	$.each(response.response.data, function (){		//因為是一個array
                          		session_panel += addSession(this);		//把每個東西塞進product_panel
                          
                          	})
                          	
                          	$("#session_panel").append(session_panel);
                          	setButtonFunction();
                            }
                          },
                        error: function () {
                            alert("無法連線到伺服器！");
                        }
                    });
                }
                
                getSession();
				
                function addSession(data) {		//每抓到一個movie 就add movie
                	
                	let inner_html = '----------------';
                	inner_html += '<div class="txt">';
                    inner_html += '<p style="font-weight:bold">場次時間：' + data.session_time + '</p>';
            		inner_html += '<p style="font-weight:bold">場次日期：' + data.session_date + '</p>';
            		//inner_html += '<div class="d-flex justify-content-between align-items-center">';
            		//inner_html += '<div class="btn-group">';
            		//inner_html += '<a class="p-2 text-dark" href="order.html?id=' + mid+'&ssid='+data.session_id+'"><font color="blue">訂票去！</font></a>';
      				inner_html += '<button id="session_id_' + data.session_id + '" name="session_id" type="button" >訂票去！</button></br>';
					//ssid = data.session_id;
            		//inner_html += '</div></div></div></div>';
            	    inner_html += '</div>'  
                	return inner_html;
            			
                }
                
                function setButtonFunction() {
                	$('button[name="session_id"]').click(function () {
                		var object = (this.id).split('_')[0];
                		var col = (this.id).split('_')[1];
                		var ssid = (this.id).split('_')[2];
                		//addProductToCart(id, 1);
						
                		var session_id = parseInt(ssid) ;
    					localStorage.setItem("movie_id", JSON.stringify(movie_id));
        				localStorage.setItem("session_id", JSON.stringify(session_id));

                        document.location.href = "order.html";
                		
                    });
                }
                
                
                
            </script>
        </div>
       
</body>

</html>